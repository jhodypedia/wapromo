
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
  <h4 class="mb-0"><i class="fa fa-message text-primary me-2"></i>Template Pesan</h4>
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createTemplateModal">
    <i class="fa fa-plus me-2"></i>Template Baru
  </button>
</div>

<div class="card shadow-sm rounded">
  <div class="card-body">
    <div class="table-responsive">
      <table id="templateTable" class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th style="width:50px">#</th>
            <th>Judul</th>
            <th>Isi</th>
            <th>Link</th>
            <th>Status</th>
            <th style="width:160px">Aksi</th>
          </tr>
        </thead>
        <tbody>
          <% templates.forEach((t, i) => { %>
          <tr id="template-<%= t.id %>">
            <td><%= i+1 %></td>
            <td class="fw-semibold"><%= t.title %></td>
            <td style="white-space:pre-wrap; max-width:250px;"><%= t.body %></td>
            <td>
              <% if (t.link) { %>
                <a href="<%= t.link %>" target="_blank"><i class="fa fa-link me-1"></i>Link</a>
              <% } else { %>
                <span class="text-muted">-</span>
              <% } %>
            </td>
            <td>
              <span class="badge rounded-pill <%= t.isActive ? 'bg-success' : 'bg-secondary' %> px-3 py-2">
                <%= t.isActive ? 'Aktif' : 'Nonaktif' %>
              </span>
            </td>
            <td class="d-flex gap-1">
              <button class="btn btn-sm btn-info text-white detail-template"
                      data-id="<%= t.id %>"
                      data-title="<%= t.title %>"
                      data-body="<%= t.body %>"
                      data-link="<%= t.link %>"
                      data-active="<%= t.isActive %>">
                <i class="fa fa-eye"></i>
              </button>
              <a href="/templates/<%= t.id %>/edit" class="btn btn-sm btn-warning">
                <i class="fa fa-edit"></i>
              </a>
              <form action="/templates/<%= t.id %>?_method=DELETE" method="post" class="d-inline"
                    onsubmit="return confirm('Hapus template ini?')">
                <button class="btn btn-sm btn-danger"><i class="fa fa-trash"></i></button>
              </form>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal Create -->
<div class="modal fade" id="createTemplateModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title"><i class="fa fa-plus text-primary me-2"></i>Tambah Template</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="createTemplateForm" method="post" action="/templates/new">
          <div class="mb-3">
            <label class="form-label">Judul</label>
            <input type="text" name="title" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Isi Pesan</label>
            <textarea name="body" class="form-control" rows="4" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Link (opsional)</label>
            <input type="text" name="link" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select name="isActive" class="form-select">
              <option value="true" selected>Aktif</option>
              <option value="false">Nonaktif</option>
            </select>
          </div>
          <button class="btn btn-primary w-100"><i class="fa fa-save me-2"></i>Simpan</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Detail -->
<div class="modal fade" id="detailTemplateModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title"><i class="fa fa-eye text-info me-2"></i>Detail Template</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="detailTemplateBody">
        <div class="text-muted">Loading...</div>
      </div>
    </div>
  </div>
</div>

<!-- DataTables CDN -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // Inisialisasi DataTable
  $('#templateTable').DataTable({
    language: {
      search: "Cari:",
      lengthMenu: "Tampilkan _MENU_ data",
      info: "Menampilkan _START_ - _END_ dari _TOTAL_ data",
      paginate: { previous: "«", next: "»" },
      zeroRecords: "Tidak ada data ditemukan"
    },
    pageLength: 5,
    ordering: false,
    responsive: true
  });

  // Detail template
  document.querySelectorAll(".detail-template").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const body = document.getElementById("detailTemplateBody");
      body.innerHTML = `
        <h6 class="fw-bold">${btn.dataset.title}</h6>
        <p class="mb-2"><b>Status:</b> ${btn.dataset.active === "true" ? "Aktif" : "Nonaktif"}</p>
        <p class="mb-2"><b>Isi Pesan:</b><br>${btn.dataset.body.replace(/\n/g,"<br>")}</p>
        <p><b>Link:</b> ${btn.dataset.link ? `<a href="${btn.dataset.link}" target="_blank">${btn.dataset.link}</a>` : '-'}</p>
      `;
      new bootstrap.Modal(document.getElementById("detailTemplateModal")).show();
    });
  });
});
</script>
